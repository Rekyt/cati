{
    "contents" : "library(cati, warn.conflicts = FALSE)\n\ndata(finch.ind)\n\ncomm2<-t(table(ind.plot.finch,1:length(ind.plot.finch)))\nrownames(comm2)<-rownames(traits.finch)\n\ncomm2.sp<-t(table(ind.plot.finch,sp.finch))\n\noldpar<-par(no.readonly = TRUE)\n\nrequire(mice)\ntraits=traits.finch\nmice<-mice(traits.finch)\ntraits.finch.mice<-complete(mice)\n\nrequire(spacodiR)\nrequire(picante)\nrequire(fBasics)\nrequire(SDMTools)\nrequire(hypervolume)\nrequire(FD)\nrequire(entropart)\n\n\n####UNIVARIATES####\nfunct1<-c(\"spacodi.calc(sp.plot = comm2, sp.traits =  as.data.frame(as.matrix(x)))$Ust\", \"spacodi.calc(sp.plot = comm2, sp.traits =  as.data.frame(as.matrix(x)))$Tst\", \"spacodi.calc(sp.plot = comm2, sp.traits =  as.data.frame(as.matrix(x)))$Ist\")\n\nfunct1.sp<-c(\"spacodi.calc(sp.plot = comm2.sp, sp.traits =  as.data.frame(as.matrix(x)))$Ust\", \"spacodi.calc(sp.plot = comm2.sp, sp.traits =  as.data.frame(as.matrix(x)))$Tst\", \"spacodi.calc(sp.plot = comm2.sp, sp.traits =  as.data.frame(as.matrix(x)))$Ist\")\n\nwt=rep(1, times=2513)\nfunct2<-c(\"weighted.mean(x, wt)\", \"wt.sd(x, wt)\")\nfunct3<-c(\"mean(x, na.rm=T)\", \"sd(x, na.rm=T)\", \"max(x, na.rm=T)-min(x, na.rm=T)\", \"kurtosis(x, na.rm=T)\", \"skewness(x, na.rm=T)\", \"CVNND(x)\")\nfunct4<-c(\"SumBL(as.matrix(x))\", \"SumBL(as.matrix(x), gower.dist=F)\")\nfunct5<-c(\"MinNND(x)\", \"MNND(x)\", \"SDNND(x)\", \"SDND(x)\", \"SDNND(x, div_range=T)\", \"SDND(x, div_range=T)\")\n\n\n# à lancer mais très long\nfunct4<-c(\"MinMaxMST(as.matrix(x))\",  \"MinMaxMST(as.matrix(x), gower.dist=F)\")\n\n\nres.finch_1<-ComIndex(traits=traits.finch.mice, index=funct1, sp=sp.finch, \n                            nullmodels=rep(2,times=3), ind.plot=ind.plot.finch,\n                            nperm=2)\n\nres.finch_2<-ComIndex(traits=traits.finch.mice, index=funct2, sp=sp.finch, \n                        nullmodels=rep(2,times=2), ind.plot=ind.plot.finch,\n                        nperm=2)\n\nres.finch_3<-ComIndex(traits=traits.finch.mice, index=funct3, sp=sp.finch, \n                        nullmodels=rep(2,times=6), ind.plot=ind.plot.finch,\n                        nperm=2)\n\nres.finch_4<-ComIndex(traits=traits.finch.mice, index=funct4, sp=sp.finch, \n                        nullmodels=2, ind.plot=ind.plot.finch,\n                        nperm=2)\n\nres.finch_5<-ComIndex(traits=traits.finch.mice, index=funct5, sp=sp.finch, \n                      nullmodels=2, ind.plot=ind.plot.finch,\n                      nperm=2)\n\n\n\n\nplotRandtest(as.listofindex(res.finch_mn1))\nplotRandtest(res.finch_mn4)\n\nspa1<-spacodi.calc(sp.plot = comm2, sp.traits = as.data.frame(as.matrix(traits.finch.mice[,1])))\nspa2<-spacodi.calc(sp.plot = comm2, sp.traits = as.data.frame(as.matrix(traits.finch.mice[,2])))\n\n\n\n####UNIVARIATES by pop####\nIndexByPop<-function(metrics, pop = \"ind.plot.finch\"){\n  res<-c()\n  for (i in 1:length(metrics)){\n    res<- c(res, paste(\"tapply(x, \", pop, \", function(x) \", metrics[i], \")\", sep=\"\"))\n  }\n  return(res)\n}\n  \nfunct.by2<-c(\"tapply(x, ind.plot.finch, function(x) weighted.mean(x, wt))\", \"tapply(x, ind.plot.finch, function(x) wt.sd(x, wt))\")\nfunct.by3<-c(\"tapply(x, ind.plot.finch, function(x) mean(x, na.rm=T))\", \"tapply(x, ind.plot.finch, function(x) sd(x, na.rm=T))\", \"tapply(x, ind.plot.finch, function(x) max(x, na.rm=T)-min(x, na.rm=T))\", \"tapply(x, ind.plot.finch, function(x) kurtosis(x, na.rm=T))\", \"tapply(x, ind.plot.finch, function(x) skewness(x, na.rm=T))\", \"tapply(x, ind.plot.finch, function(x) CVNND(x))\")\n\n\nres.finch.sp_by1<-ComIndex(traits=traits.finch.mice, index=IndexByPop(funct1), sp=sp.finch, \n                            nullmodels=rep(2,times=3), ind.plot=ind.plot.finch,\n                            nperm=2, print=FALSE)\n\nres.finch.sp_by2<-ComIndex(traits=traits.finch.mice, index=funct.by2, sp=sp.finch, \n                            nullmodels=rep(2,times=6), ind.plot=ind.plot.finch,\n                            nperm=2, print=FALSE)\n\n\nres.finch.sp_by3<-ComIndex(traits=traits.finch.mice, index=IndexByPop(funct3), sp=sp.finch, \n                           nullmodels=2, ind.plot=ind.plot.finch,\n                           nperm=2, print=FALSE)\n\n\n\n\n\n\n\n\n####MULTIVARIATES####\nfunct.m1<-c(\"mntd(comm2, dist(x),  abundance.weighted=FALSE)\", \"mpd(ind.plot.finch, dist(x),  abundance.weighted=FALSE)\")\nfunct.m2<-c(\"spacodi.calc(sp.plot = comm2, sp.traits =  as.data.frame(as.matrix(x)))$Ust\", \"spacodi.calc(sp.plot = comm2, sp.traits =  as.data.frame(as.matrix(x)))$Tst\", \"spacodi.calc(sp.plot = comm2, sp.traits =  as.data.frame(as.matrix(x)))$Ist\")\nfunct.m3<-c(\"Fred(traits.finch.mice, ind.plot.finch)$FRic\", \"Fred(traits.finch.mice, ind.plot.finch)$FEve\",\"Fred(traits.finch.mice, ind.plot.finch)$FDiv\")\n \n#funct.m5<-c(\"dbFD(x, comm2, calc.CWM = F, calc.FDiv = F)$FRic\", \"dbFD(x, comm2, calc.CWM = F, calc.FRic = F, calc.FDiv = F)$FEve\", \"dbFD(x, comm2, calc.CWM = F, calc.FRic = F)$FDiv\", \"dbFD(x, comm2, calc.CWM = F, calc.FRic = F, calc.FDiv = F)$FDis\", \"dbFD(x, comm2)$RaoQ\", \"dbFD(x, comm2, calc.FGR = T)$FGR\")\nfunct.m5<-c(\"dbFD(x[seq(1,2513, by=1),], t(comm2[seq(1,2513, by=1),]), calc.CWM = F, calc.FDiv = F)$FRic\", \"dbFD(x[seq(1,2513, by=1),], t(comm2[seq(1,2513, by=1),]), calc.CWM = F, calc.FRic = F, calc.FDiv = F)$FEve\", \"dbFD(x[seq(1,2513, by=1),], t(comm2[seq(1,2513, by=1),]))$RaoQ\")\n\nfunct.m6<-\"as.numeric(try(hypervolume(na.omit(x), reps=100, \n                           bandwidth=0.2, verbose=F, warnings=F)@Volume))\"\n\nn_sp_plot<-as.factor(paste(sp.finch, ind.plot.finch, sep=\"_\")) \n\nres.sum.3<-ComIndexMulti(traits.finch.mice, \n                        index=funct.m3, \n                        by.factor=n_sp_plot, nullmodels=rep(2,times=3), \n                        ind.plot=ind.plot.finch, nperm=2, sp=sp.finch)\n\nres.sum.3.bis<-ComIndexMulti(traits.finch.mice, \n                         index=funct.m3, \n                         nullmodels=rep(2,times=3), \n                         ind.plot=ind.plot.finch, nperm=2, sp=sp.finch)\n\nres.sum.5<-ComIndexMulti(traits.finch.mice, \n                           index=funct.m5, \n                           by.factor=n_sp_plot, nullmodels=rep(2,times=3), \n                           ind.plot=ind.plot.finch, nperm=2, sp=sp.finch)\n\ntraits.finch.mice.d<-gowdis(traits.finch.mice)\ndb.d<-dbFD(traits.finch.mice.d, calc.CWM = F, calc.FRic = F, calc.FDiv = F)\n\n#db<-dbFD(traits.finch.mice[seq(1,2500, by=15),], t(comm2[seq(1,2500, by=15),]), calc.CWM = F, calc.FRic = F, calc.FDiv = F)\n#db<-dbFD(traits.finch.mice[seq(1,2513, by=1),], t(comm2[seq(1,2513, by=1),]), calc.CWM = F, calc.FRic = F, calc.FDiv = F)\ndtfm<-dist(traits.finch.mice)\ndb<-dbFD(dtfm, as.matrix(t(comm2)), calc.CWM = F, calc.FRic = F, calc.FDiv = F, cor=\"cailliez\")\n\nfred<-F_RED(traits.finch.mice, t(comm2))\n\n\n\nx<-traits.finch.mice\na<-t(comm2)\n\nRaoQ <- divc(data.frame(t(a)), x.dist, scale = scale.RaoQ)\n\n\nres<-F_RED(traits.finch.mice, t(comm2))\n\nres.sum.2.bis<-ComIndexMulti(traits.finch.mice, \n                           index=funct.m2, \n                           by.factor=rep(1, times=dim(traits.finch.mice)[1]), nullmodels=rep(2,times=3), \n                           ind.plot=ind.plot.finch, nperm=2, sp=sp.finch)\n\nres.sum.2<-ComIndexMulti(traits.finch.mice, \n                               index=funct.m2, \n                               by.factor=n_sp_plot, nullmodels=rep(2,times=3), \n                               ind.plot=ind.plot.finch, nperm=2, sp=sp.finch)\n\ncond<-n_sp_plot==levels(n_sp_plot)[2]\nspa.m1<-spacodi.calc(sp.plot = comm2[cond,], sp.traits = as.data.frame(as.matrix(traits.finch.mice[cond,])))\n\n\n\n\nres.fred<-ComIndexMulti(traits.finch.mice, index=funct.m3,\n                        nullmodels=rep(2,times=3), \n                        ind.plot=ind.plot.finch, nperm=2, sp=sp.finch)\n\n\nres.fred<-ComIndex(traits.finch.mice, index=funct.m3,\n                        nullmodels=rep(2,times=3), \n                        ind.plot=ind.plot.finch, nperm=2, sp=sp.finch)\n\n\n\n\n\n################################\n############################\n####ENTROPART\n\nMC <- Metacomm2unity(comm2, rep(1,times=6))\n\ntraits.finch.mice.d<-gowdis(traits.finch.mice)\n\nres.PD<-PDFD(MC$Ps, hclust(traits.finch.mice.d))\n",
    "created" : 1409580162137.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "227654421",
    "id" : "7C7657AF",
    "lastKnownWriteTime" : 1409940082,
    "path" : "C:/Users/Admin/Dropbox/3-THESE/Ecologie fonctionnelle (Cyrille)/Article T stats/essai indices cati.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}